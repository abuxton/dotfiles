#

export JIRA_API_TOKEN=$(cat ~/Dropbox/profile/atlassian/jira_api_token.txt)



function atlassian_profile() {

  echo "Setting up atlassian profile"
  mkdir -p ~/.config/.jira
  echo "Generating jira completion script"
  jira completion zsh > ~/.config/.jira/.jira_completion
  source ~/.config/.jira/.jira_completion
  echo "Generating jira config file"
  if [ ! -f ~/.config/.jira/.config.yml ]; then
		touch ~/.config/.jira/.config.yml
		cat ~/Dropbox/profile/atlassian/.jira/.config.yml > ~/.config/.jira/.config.yml
	fi


  echo "Atlassian profile setup complete"
}

if 	[ -x "$(command -v jira)" ]; then
	# 	  echo "jira!"
	atlassian_profile

else
	echo "jira cli not found, skipping jira completion"
fi

alias jira-helper="jira init --installation cloud --server <SERVER_URL> --login <LOGIN> --auth-type basic  --project <PROJECT_KEY> --force --debug"

function jira-init() {
	# server, login, project key should be set in .jira/.config.yml
	echo "Initializing jira profile configuration"

  $JIRA_CONFIG << EOF
	# export JIRA_SERVER=$(cat ~/Dropbox/profile/atlassian/.jira/.config.yml | grep server: | awk '{print $2}') /
	# export JIRA_LOGIN=$(cat ~/Dropbox/profile/atlassian/.jira/.config.yml | grep login: | awk '{print $2}') /
	# export JIRA_PROJECT_KEY=$(cat  ~/Dropbox/profile/atlassian/.jira/HDM.config.yml | yaml2json | jq .project.key -r) /
	# jira init --installation cloud --server $JIRA_SERVER --login $JIRA_LOGIN --auth-type basic  --project $JIRA_PROJECT_KEY --force --debug
EOF
export JIRA_CONFIG=$(JIRA_CONFIG)

}
